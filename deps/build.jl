using BinaryProvider # requires BinaryProvider 0.3.0 or later

# Parse some basic command-line arguments
const verbose = "--verbose" in ARGS
const prefix = Prefix(get([a for a in ARGS if a != "--verbose"], 1, joinpath(@__DIR__, "usr")))
products = [
    LibraryProduct(prefix, ["libarpack"], :libarpack),
]

# Download binaries from hosted location
bin_prefix = "https://github.com/daviehh/ArpackBuilder/releases/download/v3.7.0-0"

# Listing of files generated by BinaryBuilder:
download_info = Dict(
    Linux(:aarch64, libc=:glibc, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.aarch64-linux-gnu-gcc4.tar.gz", "397ccfbce9c41dd269e983c7c50c52b916354b9d67a0852f284399a634c2ce91"),
    Linux(:aarch64, libc=:glibc, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.aarch64-linux-gnu-gcc7.tar.gz", "3fdb8c5476d20caa801e20c7070d5c9dc5918b6e41d2fb0dce2f170f2be5649d"),
    Linux(:aarch64, libc=:glibc, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.aarch64-linux-gnu-gcc8.tar.gz", "8b1e0ecb0ea13f64c8afa9be780cad701d90eb863c0e29cba17e649f1a1192fc"),
    Linux(:aarch64, libc=:musl, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.aarch64-linux-musl-gcc4.tar.gz", "6707a8ff9675629d1cf16c741a40e2377b097c71f68476100f63f51f5b968858"),
    Linux(:aarch64, libc=:musl, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.aarch64-linux-musl-gcc7.tar.gz", "ea9eecd7342d9693c22b49768981550a4758e690657c5827459ca174f0311b6b"),
    Linux(:aarch64, libc=:musl, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.aarch64-linux-musl-gcc8.tar.gz", "6800ef789ddc9b940d768f9ecd2b838a8f288aa8ad2f8c2bee27c21dffd0f989"),
    Linux(:armv7l, libc=:glibc, call_abi=:eabihf, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.arm-linux-gnueabihf-gcc4.tar.gz", "d83ef4942da37f7a8317fcde5db0255acd74ede66d4f69947c46e7d1a14589bd"),
    Linux(:armv7l, libc=:glibc, call_abi=:eabihf, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.arm-linux-gnueabihf-gcc7.tar.gz", "6eac188cb53d2e7678abeb47ae5ec92f7c374ef20fece952f9ddad99c299d779"),
    Linux(:armv7l, libc=:glibc, call_abi=:eabihf, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.arm-linux-gnueabihf-gcc8.tar.gz", "53bb7156c57779cea7b7963deed409b3297e7b1262fa8ee76f7cbbefc95ec1b6"),
    Linux(:armv7l, libc=:musl, call_abi=:eabihf, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.arm-linux-musleabihf-gcc4.tar.gz", "bf3631d155e8990ffdf9e48e210ea9dfb22f23d1ca20c1f8e064f17047d6c233"),
    Linux(:armv7l, libc=:musl, call_abi=:eabihf, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.arm-linux-musleabihf-gcc7.tar.gz", "bf29cf6f37ad17eab8fed735240a51d0c8bf35d07a0839ceeb367f99f421ce5f"),
    Linux(:armv7l, libc=:musl, call_abi=:eabihf, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.arm-linux-musleabihf-gcc8.tar.gz", "b772a8da3557493ba5c2372b941f6b3035839af294a3b5c1c3a53c6da7ed359b"),
    Linux(:i686, libc=:glibc, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.i686-linux-gnu-gcc4.tar.gz", "e596586d00c527762f373904be909c3d83a62927003c82fbdc54e0b00aa037a9"),
    Linux(:i686, libc=:glibc, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.i686-linux-gnu-gcc7.tar.gz", "5fd5c47319af4227a790b63f2edddb3ae76fdd6711c78c06b5d766b4213e2d22"),
    Linux(:i686, libc=:glibc, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.i686-linux-gnu-gcc8.tar.gz", "cccea3992b9b877be3d4cd56d8d8625f70ad8ca9d093e50f9081ca41f717ada5"),
    Linux(:i686, libc=:musl, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.i686-linux-musl-gcc4.tar.gz", "53acce7997c48f048225a6fdb198186da0823cb891c4f34b97a513d7075de88f"),
    Linux(:i686, libc=:musl, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.i686-linux-musl-gcc7.tar.gz", "9b74cdc46cedbe1a993fb74f5f72f459f1ca3c838f62eb7b466007c23e75c61e"),
    Linux(:i686, libc=:musl, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.i686-linux-musl-gcc8.tar.gz", "ae923df58d41a506a3db6eefff4dbc0953dd70b90700db55ef6bf05b02c40d99"),
    Windows(:i686, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.i686-w64-mingw32-gcc4.tar.gz", "2b31d9ca614886e82598077f27191ab80861153d26a6af8b4da2f6dc538c7e22"),
    Windows(:i686, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.i686-w64-mingw32-gcc7.tar.gz", "22512959aae7de0fd709329ec2358f1f24e79c0bef7dc0031990242ea3cc55c6"),
    Windows(:i686, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.i686-w64-mingw32-gcc8.tar.gz", "f022e873de7be200cf327d72585aec1de80f81841c2957d837cad77510f1efc2"),
    Linux(:powerpc64le, libc=:glibc, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.powerpc64le-linux-gnu-gcc4.tar.gz", "566c62b62e964872a70de777646d1e0869bc85c92f6b9c2dfabc6e5bf1beb7b5"),
    Linux(:powerpc64le, libc=:glibc, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.powerpc64le-linux-gnu-gcc7.tar.gz", "9c5b735e3eec84a0c9e460e25e3037efa1445137fd7c7021f31e004717c147a6"),
    Linux(:powerpc64le, libc=:glibc, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.powerpc64le-linux-gnu-gcc8.tar.gz", "0164b5bc93666fe186189c3671960992775b1ccc2398480558b5399e7b1c5de1"),
    MacOS(:x86_64, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-apple-darwin14-gcc4.tar.gz", "65b23380573f1746cc2a2e9eec35008dd9b059900a6b5669af94f4bbe070bf91"),
    MacOS(:x86_64, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-apple-darwin14-gcc7.tar.gz", "202680a42549c19a39eb445b0c59a06ab1e9c9e5f84e80ef4101d61238029a7e"),
    MacOS(:x86_64, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-apple-darwin14-gcc8.tar.gz", "dd6fcb138bc35668a8ca0c1d5358c72ae1645b0c2d375686208abf820f6cb536"),
    Linux(:x86_64, libc=:glibc, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-linux-gnu-gcc4.tar.gz", "8e92db14509b1b96a64e891660633ca0777b383ff739cc66d587e1d605cec9a5"),
    Linux(:x86_64, libc=:glibc, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-linux-gnu-gcc7.tar.gz", "653d78a3ba66080614471235210f46c331377d8d9950c5abb8c28e166586a56a"),
    Linux(:x86_64, libc=:glibc, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-linux-gnu-gcc8.tar.gz", "8f964d584eecbe0ae34c50963c888ca5f4b71fe80366df639bc7b461de47eabc"),
    Linux(:x86_64, libc=:musl, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-linux-musl-gcc4.tar.gz", "3b9edf0df9a8f57197b48fbd8d21bd4d30ef76efc93ef071ec3ea29a05dc9448"),
    Linux(:x86_64, libc=:musl, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-linux-musl-gcc7.tar.gz", "95c580bfda69a11b1e4b7284338306c70988db346e7e23f14d9e7673a5e35e98"),
    Linux(:x86_64, libc=:musl, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-linux-musl-gcc8.tar.gz", "ac9c65184145e7c258382893ca926776ea0226ae2f13e4966a07c73ed984519c"),
    FreeBSD(:x86_64, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-unknown-freebsd11.1-gcc4.tar.gz", "859f22d8677b498c70b6da75d233a85d712bb308020f5154b627743488a22ed5"),
    FreeBSD(:x86_64, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-unknown-freebsd11.1-gcc7.tar.gz", "8b11ccc7f39fcbbdb984b8626155ae7e86c92161c7a06bc392f139b281dd6762"),
    FreeBSD(:x86_64, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-unknown-freebsd11.1-gcc8.tar.gz", "a944c8cd12df59c7b6142dc163b92c3c6c1afa9a46216103635ccc0d857d37df"),
    Windows(:x86_64, compiler_abi=CompilerABI(:gcc4)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-w64-mingw32-gcc4.tar.gz", "5a665d6eaea729e14a3889f6be5a8aa098386d2c9a39688777600b71fbf84612"),
    Windows(:x86_64, compiler_abi=CompilerABI(:gcc7)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-w64-mingw32-gcc7.tar.gz", "dc376ea7a21606c8d43e7a52a290f067f820ba6b4bef8479d2d96d32effd9a73"),
    Windows(:x86_64, compiler_abi=CompilerABI(:gcc8)) => ("$bin_prefix/Arpack.v3.7.0.x86_64-w64-mingw32-gcc8.tar.gz", "c3b805e5a67bad0934f717df9a7427742abc6249d820cb9f91485513ca7af03a"),
)

# Install unsatisfied or updated dependencies:
unsatisfied = any(!satisfied(p; verbose=verbose) for p in products)
dl_info = choose_download(download_info, platform_key_abi())
if dl_info === nothing && unsatisfied
    # If we don't have a compatible .tar.gz to download, complain.
    # Alternatively, you could attempt to install from a separate provider,
    # build from source or something even more ambitious here.
    error("Your platform (\"$(Sys.MACHINE)\", parsed as \"$(triplet(platform_key_abi()))\") is not supported by this package!")
end

# If we have a download, and we are unsatisfied (or the version we're
# trying to install is not itself installed) then load it up!
if unsatisfied || !isinstalled(dl_info...; prefix=prefix)
    # Download and install binaries
    install(dl_info...; prefix=prefix, force=true, verbose=verbose)
end

# Write out a deps.jl file that will contain mappings for our products
write_deps_file(joinpath(@__DIR__, "deps.jl"), products, verbose=verbose)
